<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="./index.css" />
		<title>wild west</title>
	</head>
	<body onload="start()" onkeydown="keydown(event)" onkeyup="keyup(event)" style="overflow: hidden">
		<script>
			var body, canvas, context;
			body = canvas = context = null;
			var fps = (1000/4);
			// initialize 'man', man
			var man = ["./man/man_standing_west.png",
				"./man/man_standing_north.png",
				"./man/man_standing_east.png",
				"./man/man_standing_south.png",
				"./man/man_walking_west_left.png",
				"./man/man_walking_west_right.png",
				"./man/man_walking_north_left.png",
				"./man/man_walking_north_right.png",
				"./man/man_walking_east_left.png",
				"./man/man_walking_east_right.png",
				"./man/man_walking_south_left.png",
				"./man/man_walking_south_right.png"];
			var man_frames = [];
			var man_state = "standing";
			var man_direction = "south";
			var man_x = null;
			var man_y = null;
			var man_walk = 0;
			var speed = 35;

			var clear_screen = function() {
				context.clearRect(0, 0, canvas.width, canvas.height);
			}

			var init = function() {
				body = document.getElementsByTagName('body')[0];
				canvas = document.createElement('canvas');
				canvas.id = "canvas";
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
				for (var i=0; i<man.length; ++i) {
					man_frames.push(new Image());
					man_frames[i].src = man[i];
				}
				man_x = (canvas.width / 2) - (man_frames[0].width / 2);
				man_y = (canvas.height / 2) - (man_frames[0].height / 2);
				context = canvas.getContext('2d');
				body.appendChild(canvas);
			};

			var draw_man = function() {
				switch (man_direction) {
					case "north":
						if (man_state == "standing") {
						context.drawImage(man_frames[1], man_x, man_y);
						break;
					}
					if (man_walk != 0) { context.drawImage(man_frames[6], man_x, man_y); man_walk = 0; }
					else { context.drawImage(man_frames[7], man_x, man_y); man_walk = 1; }
					man_y -= speed; 
					break;
					case "east":
						if (man_state == "standing") {
						context.drawImage(man_frames[2], man_x, man_y);	
						break;
					}
					if (man_walk != 0) { context.drawImage(man_frames[8], man_x, man_y); man_walk = 0; }
					else { context.drawImage(man_frames[9], man_x, man_y); man_walk = 1; }
					man_x += speed;
					break;
					case "south":
						if (man_state == "standing") {
						context.drawImage(man_frames[3], man_x, man_y);
						break;
					}
					if (man_walk != 0) { context.drawImage(man_frames[10], man_x, man_y); man_walk = 0; }
					else { context.drawImage(man_frames[11], man_x, man_y); man_walk = 1; }
					man_y += speed;
					break;
					case "west":
						if (man_state == "standing") {
						context.drawImage(man_frames[0], man_x, man_y);
						break;
					}
					if (man_walk != 0) { context.drawImage(man_frames[4], man_x, man_y); man_walk = 0; }
					else { context.drawImage(man_frames[5], man_x, man_y); man_walk = 1; }
					man_x -= speed;
					break;
				}
			};

			var loop = function() {
				clear_screen();
				draw_man();
				setTimeout(loop, fps);
			};

			var keyup = function(e) {
				switch (e.keyCode) {
					case 37:
						case 38:
						case 39:
						case 40:
						man_state = "standing";
					break;
				}
			};

			var keydown = function(e) {	
				switch (e.keyCode) {
					case 37:
						man_direction = "west";
					man_state = "walking";
					break;
					case 38:
						man_direction = "north";
					man_state = "walking";
					break;
					case 39:
						man_direction = "east";
					man_state = "walking";
					break;
					case 40:
						man_direction = "south";
					man_state = "walking";
					break;
				}
			};

			var start = function() {
				init();
				loop();
			};
		</script>
	</body>
</html>
